{% extends 'base.html' %}

{% block title %}Create a Club - ClubiFy{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-primary-700">Create a New Club</h1>
        <p class="text-gray-600 mt-2">Start your own community and bring people together.</p>
    </div>

    <div class="card p-8">
        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}
            
            <div>
                <label for="id_name" class="label flex items-center gap-1">
                    Club Name <span class="text-red-500">*</span>
                </label>
                {{ form.name }}
                {% if form.name.help_text %}
                    <p class="text-gray-500 text-sm mt-1">{{ form.name.help_text }}</p>
                {% endif %}
                {% if form.name.errors %}
                    <p class="text-red-600 text-sm mt-1">{{ form.name.errors.0 }}</p>
                {% endif %}
            </div>

            <div>
                <label for="id_description" class="label flex items-center gap-1">
                    Description <span class="text-red-500">*</span>
                </label>
                {{ form.description }}
                {% if form.description.help_text %}
                    <p class="text-gray-500 text-sm mt-1">{{ form.description.help_text }}</p>
                {% endif %}
                {% if form.description.errors %}
                    <p class="text-red-600 text-sm mt-1">{{ form.description.errors.0 }}</p>
                {% endif %}
            </div>

            <div>
                <label for="id_logo" class="label">
                    Club Logo <span class="text-gray-400 text-sm font-normal">(optional)</span>
                </label>
                
                <div>
                    <label for="id_logo" class="relative block">
                        <input type="file" name="logo" id="id_logo" accept="image/*" class="hidden" onchange="handleFileSelect(this)">
                        <div class="flex items-center gap-3 p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-400 hover:bg-primary-50 transition-colors cursor-pointer group">
                            <div class="flex-shrink-0 w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center group-hover:bg-primary-200 transition-colors">
                                <i class="fas fa-cloud-upload-alt text-primary-600"></i>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-700 group-hover:text-primary-700">
                                    <span id="file-label">Choose a logo file</span>
                                </p>
                                <p class="text-xs text-gray-500 mt-0.5 hidden" id="file-name"></p>
                            </div>
                            <div class="flex-shrink-0">
                                <span class="inline-flex items-center px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md group-hover:border-primary-300 group-hover:text-primary-700">
                                    Browse
                                </span>
                            </div>
                        </div>
                    </label>
                </div>
                
                {% if form.logo.help_text %}
                    <p class="text-gray-500 text-sm mt-2">{{ form.logo.help_text }}</p>
                {% endif %}
                {% if form.logo.errors %}
                    <p class="text-red-600 text-sm mt-1">{{ form.logo.errors.0 }}</p>
                {% endif %}
            </div>

            <div>
                <label for="id_banner" class="label">
                    Banner Image <span class="text-gray-400 text-sm font-normal">(optional)</span>
                </label>
                
                <div>
                    <label for="id_banner" class="relative block">
                        <input type="file" name="banner" id="id_banner" accept="image/*" class="hidden" onchange="handleBannerSelect(this)">
                        <div class="flex items-center gap-3 p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-400 hover:bg-primary-50 transition-colors cursor-pointer group">
                            <div class="flex-shrink-0 w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center group-hover:bg-primary-200 transition-colors">
                                <i class="fas fa-image text-primary-600"></i>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-700 group-hover:text-primary-700">
                                    <span id="banner-file-label">Choose a banner image</span>
                                </p>
                                <p class="text-xs text-gray-500 mt-0.5 hidden" id="banner-file-name"></p>
                            </div>
                            <div class="flex-shrink-0">
                                <span class="inline-flex items-center px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md group-hover:border-primary-300 group-hover:text-primary-700">
                                    Browse
                                </span>
                            </div>
                        </div>
                    </label>
                </div>
                
                {% if form.banner.help_text %}
                    <p class="text-gray-500 text-sm mt-2">{{ form.banner.help_text }}</p>
                {% endif %}
                {% if form.banner.errors %}
                    <p class="text-red-600 text-sm mt-1">{{ form.banner.errors.0 }}</p>
                {% endif %}
            </div>

            <div>
                <span class="label">
                    Color Palette <span class="text-gray-400 text-sm font-normal">(optional)</span>
                </span>
                {% with selected_color=form.color.value|default:form.color.initial|default:'' %}
                <div class="grid grid-cols-4 gap-3 mt-3 max-w-2xl">
                    {% for value, label in form.color.field.choices %}
                        <label for="color-option-{{ forloop.counter }}" class="color-option flex flex-col items-center gap-2 p-2 rounded-lg border cursor-pointer transition shadow-sm w-full {% if selected_color == value|stringformat:"s" %}border-primary-500 ring-2 ring-primary-200 bg-primary-50{% else %}border-gray-200 hover:border-primary-200{% endif %}">
                            <input type="radio"
                                   name="{{ form.color.html_name }}"
                                   id="color-option-{{ forloop.counter }}"
                                   value="{{ value }}"
                                   class="sr-only color-radio"
                                   {% if selected_color == value|stringformat:"s" %}checked{% endif %}
                                   {% if not value %}data-random="true"{% endif %}>
                            {% if value %}
                                <span class="w-8 h-8 rounded-full border border-gray-200 shadow-inner" style="background-color: {{ value }};"></span>
                                <span class="text-xs text-gray-600 text-center leading-tight">{{ value }}</span>
                            {% else %}
                                <span class="w-8 h-8 rounded-full border-2 border-dashed border-gray-300 flex items-center justify-center text-[10px] text-gray-500 bg-gray-50">
                                    Auto
                                </span>
                                <span class="text-xs text-gray-600 text-center leading-tight">Auto</span>
                            {% endif %}
                        </label>
                    {% endfor %}
                </div>
                {% endwith %}
                {% if form.color.help_text %}
                    <p class="text-gray-500 text-sm mt-2">{{ form.color.help_text }}</p>
                {% endif %}
                {% if form.color.errors %}
                    <p class="text-red-600 text-sm mt-1">{{ form.color.errors.0 }}</p>
                {% endif %}
            </div>

            {% if form.non_field_errors %}
                <div class="bg-red-100 text-red-800 rounded-lg p-3">
                    {% for error in form.non_field_errors %}
                        <p class="text-sm">{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}

            <div class="flex items-center justify-between pt-4">
                <a href="{% url 'clubs:club_list' %}" class="inline-flex items-center gap-2 text-primary-700 hover:text-primary-800 font-medium text-sm bg-white px-3 py-1.5 rounded-md border border-gray-200 shadow-sm hover:border-primary-300 transition">
                    <i class="fas fa-arrow-left"></i>
                    <span>Back to Clubs</span>
                </a>
                <button type="submit" class="btn btn-primary">
                    Create Club
                </button>
            </div>
        </form>
    </div>
    
    <div class="mt-6 space-y-4">
        <div class="p-3 sm:p-4 bg-slate-50 border border-blue-100 rounded-lg">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-info-circle text-blue-600 text-sm sm:text-base"></i>
                </div>
                <div class="flex-1">
                    <p class="text-xs sm:text-sm text-gray-700">
                        <span class="font-semibold">Note:</span> As the creator, you'll automatically become the club's admin 
                        with full control over membership and content.
                    </p>
                </div>
            </div>
        </div>
        
        <div class="p-3 sm:p-4 bg-slate-50 border border-blue-100 rounded-lg">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-info-circle text-blue-600 text-sm sm:text-base"></i>
                </div>
                <div class="flex-1">
                    <p class="text-xs sm:text-sm text-gray-700">
                        <span class="font-semibold">Markdown supported:</span> You can use Markdown formatting.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function handleFileSelect(input) {
    const fileName = input.files[0]?.name || '';
    const fileLabel = document.getElementById('file-label');
    const fileNameDisplay = document.getElementById('file-name');
    
    if (fileName) {
        fileLabel.textContent = 'Selected file:';
        fileNameDisplay.textContent = fileName;
        fileNameDisplay.classList.remove('hidden');
    } else {
        fileLabel.textContent = 'Choose a logo file';
        fileNameDisplay.textContent = '';
        fileNameDisplay.classList.add('hidden');
    }
}

function handleBannerSelect(input) {
    const fileName = input.files[0]?.name || '';
    const fileLabel = document.getElementById('banner-file-label');
    const fileNameDisplay = document.getElementById('banner-file-name');
    
    if (fileName) {
        fileLabel.textContent = 'Selected file:';
        fileNameDisplay.textContent = fileName;
        fileNameDisplay.classList.remove('hidden');
    } else {
        fileLabel.textContent = 'Choose a banner image';
        fileNameDisplay.textContent = '';
        fileNameDisplay.classList.add('hidden');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const colorRadios = document.querySelectorAll('.color-radio');
    const colorOptions = document.querySelectorAll('.color-option');
    
    // Initialize selected state on page load
    colorRadios.forEach(radio => {
        if (radio.checked) {
            const label = radio.closest('.color-option');
            if (label) {
                label.classList.remove('border-gray-200');
                label.classList.add('border-primary-500', 'ring-2', 'ring-primary-200', 'bg-primary-50');
            }
        }
        
        radio.addEventListener('change', function() {
            // Remove selected state from all options
            colorOptions.forEach(option => {
                option.classList.remove('border-primary-500', 'ring-2', 'ring-primary-200', 'bg-primary-50');
                option.classList.add('border-gray-200');
            });
            
            // Add selected state to the checked option's label
            if (this.checked) {
                const label = this.closest('.color-option');
                if (label) {
                    label.classList.remove('border-gray-200');
                    label.classList.add('border-primary-500', 'ring-2', 'ring-primary-200', 'bg-primary-50');
                }
            }
        });
    });
});
</script>

<style>
/* Ensure color palette grid displays correctly */
.color-option {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
}

.grid.grid-cols-4 {
    display: grid !important;
    grid-template-columns: repeat(4, minmax(0, 1fr)) !important;
    gap: 0.75rem !important;
}

@media (max-width: 640px) {
    .grid.grid-cols-4 {
        grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    }
}
</style>
{% endblock %}
